Claude Rules :look👀

# Omniy 要件定義書

> **プロジェクト**: Omniy Instagram予約投稿アプリ  
> **バージョン**: 1.0  
> **作成日**: 2025-01-27  
> **承認者**: sh (プロダクトオーナー)  
> **ステータス**: 承認済み

---

## 📋 **文書概要**

本文書は、Omniy（Instagram予約投稿SaaS）の機能要件・非機能要件を定義します。1人運営MVP戦略に基づき、過度な複雑性を避けつつ、顧客価値の最大化を目指します。

### **要件分類**
- **必須要件 (Must)**: MVP リリースに不可欠
- **推奨要件 (Should)**: Phase 2 で実装検討  
- **任意要件 (Could)**: 将来的な拡張候補
- **除外要件 (Won't)**: 意図的に実装しない

---

## 🎯 **ビジネス要件**

### **BR-001: 事業目標**
```yaml
要件ID: BR-001
分類: Must
概要: 1人運営で月間売上¥5,000,000達成

具体的指標:
  - 有料ユーザー数: 500名 (12ヶ月以内)
  - 月間売上: ¥5,000,000 (12ヶ月以内)
  - 利益率: 95%以上維持
  - 顧客獲得コスト: ¥5,000以下
  - システム稼働率: 99.9%以上

成功基準:
  - 連続3ヶ月で目標売上達成
  - 顧客チャーン率5%以下
  - サポート工数週20時間以内
```

### **BR-002: ターゲットユーザー**
```yaml
要件ID: BR-002
分類: Must
概要: 日本の個人・小規模事業者をターゲット

プライマリーペルソナ:
  個人インフルエンサー:
    - フォロワー数: 1,000-100,000
    - 年齢: 20-40代
    - 投稿頻度: 週3-7回
    - 課題: 投稿時間の最適化・継続的投稿

セカンダリーペルソナ:
  小規模ビジネス:
    - 従業員数: 1-10名
    - 業種: 美容・飲食・小売・サービス
    - 課題: マーケティング効率化・人手不足

除外ユーザー:
  - 大企業 (従業員100名以上)
  - 複雑なワークフロー要求企業
  - 高度カスタマイズ要求顧客
```

### **BR-003: 価値提案**
```yaml
要件ID: BR-003
分類: Must
概要: Instagram投稿の自動化による時間削減・効果向上

提供価値:
  時間削減:
    - 投稿作業90%削減 (手動 → 自動)
    - スケジューリング作業80%削減
    - コンテンツ管理時間50%削減

  効果向上:
    - エンゲージメント30%改善 (最適時間投稿)
    - 投稿継続率95%以上 (自動化)
    - ブランド一貫性向上

  運用効率:
    - 月間運用時間10時間以下
    - エラー率1%以下
    - サポート依存度最小化
```

---

## 🔧 **機能要件**

### **FR-001: 認証・ユーザー管理**
```yaml
要件ID: FR-001
分類: Must
概要: Firebase Authによる安全なユーザー認証

詳細機能:
  ユーザー登録:
    - Googleアカウント認証 (OAuth 2.0)
    - メールアドレス必須入力
    - 利用規約・プライバシーポリシー同意
    - 無料プラン自動適用

  ログイン・セッション管理:
    - Google OAuth ワンクリックログイン
    - セッション有効期限: 30日間
    - 自動ログアウト (非アクティブ24時間)
    - パスワードレス認証

  プロフィール管理:
    - 基本情報編集 (名前・メール・プロフィール画像)
    - アカウント削除機能
    - データエクスポート機能 (GDPR対応)

受入基準:
  - Google認証成功率99%以上
  - ログイン時間3秒以内
  - セッション管理エラー0件/日
```

### **FR-002: Instagram連携**
```yaml
要件ID: FR-002
分類: Must
概要: Instagram Graph API による安全なアカウント連携

詳細機能:
  アカウント連携:
    - Instagram Graph API v18.0 使用
    - OAuth 2.0 認証フロー
    - 長期アクセストークン取得・保存
    - トークン自動更新 (有効期限60日前)

  アカウント管理:
    - 基本情報表示 (ユーザー名・フォロワー数・アバター)
    - 接続状態監視・エラー通知
    - アカウント削除・再連携機能
    - 複数アカウント対応 (MVP: 1アカウント、将来: 3アカウント)

  権限管理:
    - instagram_graph_user_profile
    - instagram_graph_user_media
    - pages_show_list
    - instagram_basic
    - instagram_content_publish

受入基準:
  - 連携成功率98%以上
  - トークン更新失敗率1%以下
  - API エラーハンドリング100%
```

### **FR-003: 投稿スケジューリング**
```yaml
要件ID: FR-003
分類: Must
概要: 柔軟な投稿スケジューリング機能

詳細機能:
  基本スケジューリング:
    - 日時指定投稿 (分単位精度)
    - 繰り返し投稿 (曜日×時刻指定)
    - タイムゾーン対応 (日本標準時)
    - 夏時間自動調整

  スケジュール管理:
    - スケジュール一覧表示 (フィルタ・ソート機能)
    - スケジュール編集・削除機能
    - 実行前のスケジュール確認
    - 実行結果・ログ表示

  高度スケジューリング (Phase 2):
    - ランダム投稿 (機能フラグで制御)
    - 最適時間提案 (AI分析)
    - バルクスケジューリング

受入基準:
  - スケジュール精度: ±2分以内
  - 繰り返し投稿エラー率: 1%以下
  - UI応答時間: 2秒以内
```

### **FR-004: コンテンツ管理**
```yaml
要件ID: FR-004
分類: Must
概要: 投稿コンテンツの作成・管理機能

詳細機能:
  コンテンツ作成:
    - 画像アップロード (JPEG, PNG, 最大10MB)
    - カルーセル投稿対応 (最大10枚)
    - キャプション入力 (最大2,200文字)
    - ハッシュタグ管理・提案

  コンテンツライブラリ:
    - コンテンツ一覧表示 (グリッドビュー)
    - タグ・カテゴリ管理
    - 検索・フィルタ機能
    - コンテンツ統計表示

  画像処理:
    - 自動リサイズ (1080x1080px推奨)
    - 画像圧縮 (品質90%)
    - プレビュー生成
    - EXIF データ削除

受入基準:
  - 画像アップロード成功率: 99%以上
  - 処理時間: 30秒以内
  - ストレージ効率: 70%以上
```

### **FR-005: 自動投稿実行**
```yaml
要件ID: FR-005
分類: Must
概要: 確実で安定した自動投稿実行システム

詳細機能:
  投稿実行エンジン:
    - Cloud Scheduler (1分間隔実行)
    - 並行処理 (最大5投稿同時)
    - リトライ機能 (最大3回、Exponential Backoff)
    - 実行ログ記録・監視

  投稿処理:
    - Instagram Graph API 経由投稿
    - 単一画像・カルーセル対応
    - 投稿状態確認・更新
    - エラーハンドリング・通知

  監視・復旧:
    - 投稿失敗検知・アラート
    - 手動再実行機能
    - 期限切れスケジュールクリーンアップ
    - パフォーマンス監視

受入基準:
  - 投稿成功率: 99.5%以上
  - 実行精度: ±2分以内
  - システム可用性: 99.9%以上
```

### **FR-006: 決済・プラン管理**
```yaml
要件ID: FR-006
分類: Must
概要: Stripe による安全な決済・サブスクリプション管理

詳細機能:
  プラン管理:
    - 無料プラン (月5投稿、1アカウント)
    - 有料プラン (月50投稿、1アカウント、¥1,980)
    - プラン制限チェック・執行
    - 使用量ダッシュボード

  決済処理:
    - Stripe Checkout 統合
    - クレジットカード決済
    - サブスクリプション自動更新
    - 決済履歴管理

  Webhook 処理:
    - 支払い成功・失敗処理
    - サブスクリプション状態更新
    - 請求書自動送信
    - プラン変更処理

受入基準:
  - 決済成功率: 98%以上
  - Webhook処理時間: 5秒以内
  - PCI DSS 準拠
```

### **FR-007: 通知システム**
```yaml
要件ID: FR-007
分類: Should
概要: 投稿結果・重要イベントの通知機能

詳細機能:
  通知種類:
    - 投稿成功・失敗通知
    - プラン制限到達警告
    - アカウント接続エラー
    - 決済関連通知

  通知チャネル:
    - メール通知 (MVP対応)
    - アプリ内通知
    - プッシュ通知 (将来対応)
    - Webhook通知 (API連携用)

  通知設定:
    - 通知種類別ON/OFF設定
    - 通知頻度設定
    - 通知時間帯設定

受入基準:
  - メール送信成功率: 99%以上
  - 通知遅延: 5分以内
  - スパム判定回避: 95%以上
```

---

## 🚫 **除外機能 (MVP から意図的に除外)**

### **EX-001: 高度機能の除外**
```yaml
除外理由: 1人運営には複雑すぎ、サポート負荷大

除外機能一覧:
  ランダム投稿:
    - 実装済みだが機能フラグで無効化
    - Phase 2 で再検討

  プロキシ管理:
    - エンタープライズ向け機能
    - 運用コスト高、需要限定的

  チーム・グループ機能:
    - ワークフロー複雑化
    - サポートコスト増大

  カレンダー表示:
    - 開発コスト高
    - 代替手段で十分

  多言語対応:
    - 日本市場特化戦略
    - 翻訳・保守コスト高

  高度アナリティクス:
    - Instagram Insights API 複雑
    - 分析機能過剰

将来検討条件:
  - 月売上¥1,000,000達成後
  - 顧客からの強い要望 (30%以上)
  - 実装・保守コスト月¥10,000以内
```

---

## ⚡ **非機能要件**

### **NFR-001: パフォーマンス**
```yaml
要件ID: NFR-001
分類: Must
概要: 高速で快適なユーザー体験

詳細要件:
  応答時間:
    - ページロード時間: 3秒以内
    - API応答時間: 500ms以内 (平均)
    - データベースクエリ: 200ms以内
    - 画像アップロード: 30秒以内

  スループット:
    - 同時ユーザー数: 100名
    - 1日投稿処理数: 1,000件
    - API呼び出し: 10,000回/日
    - データベース接続: 50同時

  スケーラビリティ:
    - ユーザー数: 500名まで対応
    - ストレージ: 100GB まで
    - 自動スケーリング対応
    - 水平拡張可能設計

測定方法:
  - Lighthouse CI (毎回ビルド時)
  - Firebase Performance Monitoring
  - Cloud Functions 実行時間監視
  - リアルユーザーモニタリング (RUM)
```

### **NFR-002: 可用性・信頼性**
```yaml
要件ID: NFR-002
分類: Must
概要: 高い稼働率と障害復旧能力

詳細要件:
  稼働率:
    - システム全体: 99.9% (月8.76時間停止以内)
    - 投稿実行機能: 99.95% (月2.16時間停止以内)
    - 決済機能: 99.99% (月4.32分停止以内)

  復旧時間:
    - 障害検知: 5分以内
    - 障害復旧: 1時間以内
    - データ復旧: 4時間以内
    - サービス復旧通知: 10分以内

  データ保護:
    - 自動バックアップ (日次)
    - 地理的冗長性 (asia-northeast1)
    - データ整合性チェック
    - ポイントインタイム復旧 (7日間)

監視項目:
  - Uptime 監視 (外部サービス)
  - ヘルスチェック API
  - エラー率監視
  - レスポンス時間監視
```

### **NFR-003: セキュリティ**
```yaml
要件ID: NFR-003
分類: Must
概要: 包括的なセキュリティ対策

詳細要件:
  認証・認可:
    - OAuth 2.0 + OpenID Connect
    - JWT トークン (有効期限1時間)
    - 多要素認証 (Google Authenticator)
    - アクセス制御 (RBAC)

  データ保護:
    - 保存時暗号化 (AES-256)
    - 通信時暗号化 (TLS 1.3)
    - 個人情報匿名化
    - データ保存期間制限 (5年)

  インフラセキュリティ:
    - Firebase Security Rules
    - Cloud Functions IAM
    - VPC ネットワーク分離
    - DDoS 攻撃対策

  コンプライアンス:
    - GDPR 準拠 (データポータビリティ)
    - 個人情報保護法準拠
    - PCI DSS レベル1 (Stripe経由)
    - SOC 2 Type II (Firebase)

脆弱性対策:
  - 定期セキュリティスキャン
  - 依存関係脆弱性チェック
  - ペネトレーションテスト (年次)
  - セキュリティヘッダー設定
```

### **NFR-004: ユーザビリティ**
```yaml
要件ID: NFR-004
分類: Must
概要: 直感的で使いやすいインターフェース

詳細要件:
  UI/UX設計:
    - レスポンシブデザイン (PC/タブレット/スマホ)
    - 日本語特化 UI (右から左レイアウト考慮)
    - アクセシビリティ対応 (WCAG 2.1 AA)
    - 一貫性のあるデザインシステム

  操作性:
    - 初回投稿設定: 5分以内
    - 新規投稿作成: 3分以内
    - ナビゲーション階層: 3クリック以内
    - エラーメッセージ: 理解しやすい日本語

  学習コストの低減:
    - オンボーディング機能
    - コンテキストヘルプ
    - FAQ・ヘルプセンター
    - チュートリアル動画

測定指標:
  - タスク完了率: 95%以上
  - エラー率: 5%以下
  - ユーザー満足度: 4.0/5.0以上
  - サポート問い合わせ率: 10%以下
```

### **NFR-005: 保守性・拡張性**
```yaml
要件ID: NFR-005
分類: Should
概要: 持続可能な開発・運用体制

詳細要件:
  コード品質:
    - TypeScript 使用 (型安全性)
    - ESLint エラーゼロ
    - コードカバレッジ 80%以上
    - Cyclomatic Complexity 10以下

  アーキテクチャ:
    - マイクロサービス設計
    - API ファースト設計
    - 疎結合・高凝集
    - 12 Factor App 準拠

  開発効率:
    - 自動テスト・デプロイ
    - ホットリロード開発環境
    - API ドキュメント自動生成
    - エラー監視・ログ集約

  技術的負債管理:
    - 定期リファクタリング
    - 依存関係定期更新
    - パフォーマンス監視
    - セキュリティパッチ適用

運用効率:
  - 1人運営可能な複雑度
  - 自動化率 90%以上
  - 手動作業時間 週20時間以内
  - 緊急対応時間 平均1時間以内
```

---

## 🎯 **受入基準・テスト要件**

### **AC-001: 機能受入基準**
```yaml
投稿スケジューリング:
  Given: ユーザーが投稿をスケジュール設定
  When: 設定した日時が到来
  Then: 投稿が Instagram に自動実行される
  And: 実行結果がログに記録される
  And: ユーザーに結果通知される

エラーハンドリング:
  Given: Instagram API エラーが発生
  When: 投稿実行が失敗
  Then: 自動リトライが3回実行される
  And: 最終失敗時にユーザーに通知される
  And: エラーログが詳細記録される

プラン制限:
  Given: ユーザーが月間投稿制限に達した
  When: 新しい投稿をスケジュール設定
  Then: 制限エラーメッセージが表示される
  And: アップグレード案内が表示される
```

### **AC-002: パフォーマンス受入基準**
```yaml
負荷テスト:
  - 100同時ユーザーで応答時間3秒以内
  - 1,000投稿/日処理で遅延なし
  - メモリ使用量 500MB以内

ストレステスト:
  - 200%負荷で30分間稼働
  - 復旧時間 5分以内
  - データ整合性 100%維持

エンドツーエンドテスト:
  - ユーザー登録 → 投稿 → 削除フロー
  - 決済 → プラン変更 → キャンセルフロー
  - 複数アカウント管理フロー
```

### **AC-003: セキュリティ受入基準**
```yaml
脆弱性テスト:
  - OWASP Top 10 対策確認
  - SQL インジェクション対策
  - XSS 攻撃対策
  - CSRF 攻撃対策

認証テスト:
  - 不正トークンで API アクセス拒否
  - セッション有効期限切れ検知
  - 権限外データアクセス防止

データ保護テスト:
  - 暗号化データ確認
  - 個人情報マスキング確認
  - データ削除機能確認
```

---

## 📊 **要件トレーサビリティマトリックス**

| ビジネス要件 | 機能要件 | 非機能要件 | テストケース | 実装状況 |
|-------------|---------|-----------|-------------|-----------|
| BR-001 (事業目標) | FR-006 (決済) | NFR-002 (可用性) | AC-001 | ✅ 完了 |
| BR-002 (ターゲット) | FR-001 (認証) | NFR-004 (UX) | AC-001 | ✅ 完了 |
| BR-003 (価値提案) | FR-003 (スケジュール) | NFR-001 (性能) | AC-002 | ✅ 完了 |
| BR-003 (価値提案) | FR-005 (自動実行) | NFR-002 (可用性) | AC-002 | ✅ 完了 |
| BR-001 (事業目標) | FR-002 (Instagram) | NFR-003 (セキュリティ) | AC-003 | ✅ 完了 |

---

## 🔄 **要件変更管理**

### **変更プロセス**
```yaml
変更要求:
  1. 変更要求書作成 (Change Request Form)
  2. 影響度分析 (工数・コスト・リスク)
  3. ステークホルダー承認
  4. 要件文書更新
  5. 実装・テスト・デプロイ

承認権限:
  軽微変更 (工数4時間以内): Claude PM
  中程度変更 (工数40時間以内): sh承認
  重大変更 (アーキテクチャ影響): ステアリング会議

変更影響度評価:
  Low: 既存機能影響なし、追加のみ
  Medium: 既存機能軽微修正、テスト必要
  High: アーキテクチャ変更、全面テスト必要
```

### **要件バージョン管理**
```yaml
バージョニング:
  - Major: 大幅な機能追加・削除
  - Minor: 機能修正・改善
  - Patch: バグ修正・軽微修正

変更履歴:
  v1.0 (2025-01-27): 初版作成・MVP要件確定
  v1.1 (予定): Phase 2 要件追加
  v2.0 (予定): エンタープライズ機能要件
```

---

## ✅ **要件承認**

### **承認記録**
```yaml
要件レビュー:
  作成者: Claude PM
  レビュー日: 2025-01-27
  承認者: sh (プロダクトオーナー)
  承認日: 2025-01-27

品質確認:
  - 要件完全性: ✅ 確認済み
  - 要件一貫性: ✅ 確認済み
  - テスト可能性: ✅ 確認済み
  - 実装可能性: ✅ 確認済み

次回レビュー予定:
  - 日時: 2025-04-27 (四半期レビュー)
  - 対象: Phase 2 要件追加検討
  - 承認者: sh + 顧客フィードバック
```

---

**この要件定義書に基づき、全ての実装・テスト・デプロイが実行されます。**  
**要件変更は必ず変更管理プロセスに従って実施してください。**

---
*Document ID: REQ-001*  
*Classification: Internal*  
*Distribution: sh, Claude PM, Development Team*